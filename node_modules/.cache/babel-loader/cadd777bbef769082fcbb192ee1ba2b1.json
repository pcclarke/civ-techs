{"ast":null,"code":"import { cloneDeep } from 'lodash';\nimport { getLeadsTo } from './dataTools.js';\nimport { orderDisplayed } from '../libs/orderDisplayed.js';\nimport { setupArcs } from '../libs/setupArcs.js';\nexport function setupData(data, nonTechnologies, installment, types) {\n  const sortedData = createUnlocks(data, nonTechnologies, installment, types);\n  const orderedData = orderDisplayed(sortedData, installment);\n  const setupArc = setupArcs(orderedData);\n  return setupArc;\n}\n\nfunction createUnlocks(data, nonTechnologies, installment, types) {\n  let sortedData = cloneDeep(data);\n  let displayed = [];\n  let unlocksList = []; // First, arrange the technologies by cost\n\n  if (installment > 3) {\n    sortedData.technologies.sort((a, b) => b.cost - a.cost);\n  } // Scoop up all the things each technology leads to and put it in the unlocks object\n\n\n  sortedData.technologies.forEach(d => {\n    let uniqueUnlocks = [];\n    let unlocks;\n    performance.mark('mark1');\n    d.cat = 'technologies';\n    displayed.push(d);\n    unlocks = getLeadsTo(d, sortedData.units);\n    unlocks = unlocks.concat(getLeadsTo(d, sortedData.buildings));\n    unlocks = unlocks.concat(getLeadsTo(d, sortedData.build));\n\n    if (sortedData.civics) {\n      unlocks = unlocks.concat(getLeadsTo(d, sortedData.civics));\n    }\n\n    if (sortedData.projects) {\n      unlocks = unlocks.concat(getLeadsTo(d, sortedData.projects));\n    }\n\n    if (sortedData.promotions) {\n      unlocks = unlocks.concat(getLeadsTo(d, sortedData.promotions));\n    }\n\n    if (sortedData.religions) {\n      unlocks = unlocks.concat(getLeadsTo(d, sortedData.religions));\n    }\n\n    if (sortedData.resources) {\n      unlocks = unlocks.concat(getLeadsTo(d, sortedData.resources));\n    }\n\n    performance.mark('mark2');\n\n    if (d.special) {\n      d.special.forEach(s => {\n        s.cat = 'specials';\n        s.requires = [];\n        s.requires.push(d.id);\n        unlocks.push(s);\n      });\n    }\n\n    performance.mark('mark3');\n    unlocks.forEach((u, j) => {\n      let matchFound = 0;\n      unlocksList.forEach((l, k) => {\n        if (u.id === l.id) {\n          matchFound = 1;\n        }\n      });\n\n      if (matchFound !== 1) {\n        uniqueUnlocks.push(u);\n      }\n    });\n    unlocksList = unlocksList.concat(uniqueUnlocks);\n    performance.mark('mark4');\n    let unlocksHandler = [];\n    uniqueUnlocks.forEach((u, j) => {\n      let unlocksItem = {};\n      unlocksItem.rank = j;\n      unlocksItem.ref = u;\n      unlocksHandler.push(unlocksItem);\n    });\n    d.unlocks = unlocksHandler;\n    performance.mark('mark5');\n    performance.measure(\"measure createUnlocks\", 'mark1', 'mark2');\n    performance.measure(\"measure orderDisplayed\", 'mark2', 'mark3');\n    performance.measure(\"measure setupArcs\", 'mark3', 'mark4');\n    performance.measure(\"measure setupArcs\", 'mark4', 'mark5');\n    console.log(performance.getEntriesByType(\"measure\"));\n  });\n  sortedData.displayed = displayed; // Label data categories\n\n  types.forEach(t => {\n    if (sortedData[t]) {\n      sortedData[t].forEach(d => {\n        d.cat = t;\n      });\n    }\n  });\n  return sortedData;\n}","map":{"version":3,"sources":["/Users/pcclarke/Documents/GitHub/civ-techs/src/libs/setupData.js"],"names":["cloneDeep","getLeadsTo","orderDisplayed","setupArcs","setupData","data","nonTechnologies","installment","types","sortedData","createUnlocks","orderedData","setupArc","displayed","unlocksList","technologies","sort","a","b","cost","forEach","d","uniqueUnlocks","unlocks","performance","mark","cat","push","units","concat","buildings","build","civics","projects","promotions","religions","resources","special","s","requires","id","u","j","matchFound","l","k","unlocksHandler","unlocksItem","rank","ref","measure","console","log","getEntriesByType","t"],"mappings":"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","sourcesContent":["import {cloneDeep} from 'lodash';\n\nimport {getLeadsTo} from './dataTools.js';\nimport {orderDisplayed}  from '../libs/orderDisplayed.js';\nimport {setupArcs} from '../libs/setupArcs.js';\n\nexport function setupData(data, nonTechnologies, installment, types) {\n  \n  const sortedData = createUnlocks(data, nonTechnologies, installment, types);\n  \n  const orderedData = orderDisplayed(sortedData, installment);\n  \n  const setupArc = setupArcs(orderedData);\n  \n\n\n\n  \n\n  return setupArc;\n}\n\nfunction createUnlocks(data, nonTechnologies, installment, types) {\n  let sortedData = cloneDeep(data);\n  let displayed = [];\n  let unlocksList = [];\n\n  // First, arrange the technologies by cost\n  if (installment > 3) {\n    sortedData.technologies.sort((a, b) => b.cost - a.cost);\n  }\n\n  // Scoop up all the things each technology leads to and put it in the unlocks object\n  sortedData.technologies.forEach((d) => {\n    let uniqueUnlocks = [];\n    let unlocks;\n\n    performance.mark('mark1');\n    d.cat = 'technologies';\n    displayed.push(d);\n\n    unlocks = getLeadsTo(d, sortedData.units);\n    unlocks = unlocks.concat(getLeadsTo(d, sortedData.buildings));\n    unlocks = unlocks.concat(getLeadsTo(d, sortedData.build));\n    if (sortedData.civics) {\n        unlocks = unlocks.concat(getLeadsTo(d, sortedData.civics));\n    }\n    if (sortedData.projects) {\n        unlocks = unlocks.concat(getLeadsTo(d, sortedData.projects));\n    }\n    if (sortedData.promotions) {\n        unlocks = unlocks.concat(getLeadsTo(d, sortedData.promotions));\n    }\n    if (sortedData.religions) {\n        unlocks = unlocks.concat(getLeadsTo(d, sortedData.religions));\n    }\n    if (sortedData.resources) {\n        unlocks = unlocks.concat(getLeadsTo(d, sortedData.resources));\n    }\n\n    performance.mark('mark2');\n\n    if (d.special) {\n      d.special.forEach((s) => {\n        s.cat = 'specials';\n        s.requires = [];\n        s.requires.push(d.id);\n        unlocks.push(s);\n      });\n    }\n\n    performance.mark('mark3');\n\n    unlocks.forEach((u, j) => {\n      let matchFound = 0;\n      unlocksList.forEach((l, k) => {\n        if (u.id === l.id) {\n          matchFound = 1;\n        }\n      });\n      if (matchFound !== 1) {\n          uniqueUnlocks.push(u);\n      }\n    });\n    unlocksList = unlocksList.concat(uniqueUnlocks);\n\n    performance.mark('mark4');\n\n    let unlocksHandler = [];\n    uniqueUnlocks.forEach((u, j) => {\n      let unlocksItem = {};\n      unlocksItem.rank = j;\n      unlocksItem.ref = u;\n      unlocksHandler.push(unlocksItem);\n    });\n    d.unlocks = unlocksHandler;\n\n    performance.mark('mark5');\n\n    performance.measure(\"measure createUnlocks\", 'mark1', 'mark2');\n    performance.measure(\"measure orderDisplayed\", 'mark2', 'mark3');\n    performance.measure(\"measure setupArcs\", 'mark3', 'mark4');\n    performance.measure(\"measure setupArcs\", 'mark4', 'mark5');\n    console.log(performance.getEntriesByType(\"measure\"));\n  });\n\n  sortedData.displayed = displayed;\n\n  // Label data categories\n  types.forEach((t) => {\n    if (sortedData[t]) {\n      sortedData[t].forEach((d) => {\n        d.cat = t;\n      });\n    }\n  });\n\n  return sortedData;\n}"]},"metadata":{},"sourceType":"module"}