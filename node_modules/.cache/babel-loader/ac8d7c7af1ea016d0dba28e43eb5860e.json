{"ast":null,"code":"import { getLeadsTo } from 'dataTools.js';\nexport function setupData(data, installment, types) {\n  let sortedData = cloneDeep(data);\n  let displayed = [];\n  let unlocksList = []; // First, arrange the technologies by cost\n\n  if (installment > 3) {\n    sortedData.technologies.sort((a, b) => b.cost - a.cost);\n  } // Scoop up all the things each technology leads to and put it in the unlocks object\n\n\n  sortedData.technologies.forEach(d => {\n    let uniqueUnlocks = [];\n    let unlocks;\n    d.cat = 'technologies';\n    displayed.push(d);\n    unlocks = getLeadsTo(d, sortedData.units);\n    unlocks = unlocks.concat(getLeadsTo(d, sortedData.buildings));\n    unlocks = unlocks.concat(getLeadsTo(d, sortedData.build));\n\n    if (sortedData.civics) {\n      unlocks = unlocks.concat(getLeadsTo(d, sortedData.civics));\n    }\n\n    if (sortedData.projects) {\n      unlocks = unlocks.concat(getLeadsTo(d, sortedData.projects));\n    }\n\n    if (sortedData.promotions) {\n      unlocks = unlocks.concat(getLeadsTo(d, sortedData.promotions));\n    }\n\n    if (sortedData.religions) {\n      unlocks = unlocks.concat(getLeadsTo(d, sortedData.religions));\n    }\n\n    if (sortedData.resources) {\n      unlocks = unlocks.concat(getLeadsTo(d, sortedData.resources));\n    }\n\n    if (d.special) {\n      d.special.forEach(function (s) {\n        s.cat = 'specials';\n        s.requires = [];\n        s.requires.push(d.id);\n        unlocks.push(s);\n      });\n    }\n\n    unlocks.forEach(function (u, j) {\n      let matchFound = 0;\n      unlocksList.forEach(function (l, k) {\n        if (u.id === l.id) {\n          matchFound = 1;\n        }\n      });\n\n      if (matchFound !== 1) {\n        uniqueUnlocks.push(u);\n      }\n    });\n    unlocksList = unlocksList.concat(uniqueUnlocks);\n    let unlocksHandler = [];\n    uniqueUnlocks.forEach(function (u, j) {\n      let unlocksItem = {};\n      unlocksItem.rank = j;\n      unlocksItem.ref = u;\n      unlocksHandler.push(unlocksItem);\n    });\n    d.unlocks = unlocksHandler;\n  }); // Label data categories\n\n  types.forEach(function (t) {\n    if (sortedData[t]) {\n      sortedData[t].forEach(function (d) {\n        d.cat = t;\n      });\n    }\n  });\n  return sortedData;\n}","map":{"version":3,"sources":["/Users/pcclarke/Documents/GitHub/civ-techs/src/libs/setupData.js"],"names":["getLeadsTo","setupData","data","installment","types","sortedData","cloneDeep","displayed","unlocksList","technologies","sort","a","b","cost","forEach","d","uniqueUnlocks","unlocks","cat","push","units","concat","buildings","build","civics","projects","promotions","religions","resources","special","s","requires","id","u","j","matchFound","l","k","unlocksHandler","unlocksItem","rank","ref","t"],"mappings":"AAAA,SAAQA,UAAR,QAAyB,cAAzB;AAEA,OAAO,SAASC,SAAT,CAAmBC,IAAnB,EAAyBC,WAAzB,EAAsCC,KAAtC,EAA6C;AAClD,MAAIC,UAAU,GAAGC,SAAS,CAACJ,IAAD,CAA1B;AACA,MAAIK,SAAS,GAAG,EAAhB;AACA,MAAIC,WAAW,GAAG,EAAlB,CAHkD,CAKlD;;AACA,MAAIL,WAAW,GAAG,CAAlB,EAAqB;AACnBE,IAAAA,UAAU,CAACI,YAAX,CAAwBC,IAAxB,CAA6B,CAACC,CAAD,EAAIC,CAAJ,KAAUA,CAAC,CAACC,IAAF,GAASF,CAAC,CAACE,IAAlD;AACD,GARiD,CAUlD;;;AACAR,EAAAA,UAAU,CAACI,YAAX,CAAwBK,OAAxB,CAAiCC,CAAD,IAAO;AACrC,QAAIC,aAAa,GAAG,EAApB;AACA,QAAIC,OAAJ;AAEAF,IAAAA,CAAC,CAACG,GAAF,GAAQ,cAAR;AACAX,IAAAA,SAAS,CAACY,IAAV,CAAeJ,CAAf;AAEAE,IAAAA,OAAO,GAAGjB,UAAU,CAACe,CAAD,EAAIV,UAAU,CAACe,KAAf,CAApB;AACAH,IAAAA,OAAO,GAAGA,OAAO,CAACI,MAAR,CAAerB,UAAU,CAACe,CAAD,EAAIV,UAAU,CAACiB,SAAf,CAAzB,CAAV;AACAL,IAAAA,OAAO,GAAGA,OAAO,CAACI,MAAR,CAAerB,UAAU,CAACe,CAAD,EAAIV,UAAU,CAACkB,KAAf,CAAzB,CAAV;;AACA,QAAIlB,UAAU,CAACmB,MAAf,EAAuB;AACnBP,MAAAA,OAAO,GAAGA,OAAO,CAACI,MAAR,CAAerB,UAAU,CAACe,CAAD,EAAIV,UAAU,CAACmB,MAAf,CAAzB,CAAV;AACH;;AACD,QAAInB,UAAU,CAACoB,QAAf,EAAyB;AACrBR,MAAAA,OAAO,GAAGA,OAAO,CAACI,MAAR,CAAerB,UAAU,CAACe,CAAD,EAAIV,UAAU,CAACoB,QAAf,CAAzB,CAAV;AACH;;AACD,QAAIpB,UAAU,CAACqB,UAAf,EAA2B;AACvBT,MAAAA,OAAO,GAAGA,OAAO,CAACI,MAAR,CAAerB,UAAU,CAACe,CAAD,EAAIV,UAAU,CAACqB,UAAf,CAAzB,CAAV;AACH;;AACD,QAAIrB,UAAU,CAACsB,SAAf,EAA0B;AACtBV,MAAAA,OAAO,GAAGA,OAAO,CAACI,MAAR,CAAerB,UAAU,CAACe,CAAD,EAAIV,UAAU,CAACsB,SAAf,CAAzB,CAAV;AACH;;AACD,QAAItB,UAAU,CAACuB,SAAf,EAA0B;AACtBX,MAAAA,OAAO,GAAGA,OAAO,CAACI,MAAR,CAAerB,UAAU,CAACe,CAAD,EAAIV,UAAU,CAACuB,SAAf,CAAzB,CAAV;AACH;;AAED,QAAIb,CAAC,CAACc,OAAN,EAAe;AACbd,MAAAA,CAAC,CAACc,OAAF,CAAUf,OAAV,CAAkB,UAAUgB,CAAV,EAAa;AAC7BA,QAAAA,CAAC,CAACZ,GAAF,GAAQ,UAAR;AACAY,QAAAA,CAAC,CAACC,QAAF,GAAa,EAAb;AACAD,QAAAA,CAAC,CAACC,QAAF,CAAWZ,IAAX,CAAgBJ,CAAC,CAACiB,EAAlB;AACAf,QAAAA,OAAO,CAACE,IAAR,CAAaW,CAAb;AACD,OALD;AAMD;;AAEDb,IAAAA,OAAO,CAACH,OAAR,CAAgB,UAAUmB,CAAV,EAAaC,CAAb,EAAgB;AAC9B,UAAIC,UAAU,GAAG,CAAjB;AACA3B,MAAAA,WAAW,CAACM,OAAZ,CAAoB,UAAUsB,CAAV,EAAaC,CAAb,EAAgB;AAClC,YAAIJ,CAAC,CAACD,EAAF,KAASI,CAAC,CAACJ,EAAf,EAAmB;AACjBG,UAAAA,UAAU,GAAG,CAAb;AACD;AACF,OAJD;;AAKA,UAAIA,UAAU,KAAK,CAAnB,EAAsB;AAClBnB,QAAAA,aAAa,CAACG,IAAd,CAAmBc,CAAnB;AACH;AACF,KAVD;AAWAzB,IAAAA,WAAW,GAAGA,WAAW,CAACa,MAAZ,CAAmBL,aAAnB,CAAd;AAEA,QAAIsB,cAAc,GAAG,EAArB;AACAtB,IAAAA,aAAa,CAACF,OAAd,CAAsB,UAAUmB,CAAV,EAAaC,CAAb,EAAgB;AACpC,UAAIK,WAAW,GAAG,EAAlB;AACAA,MAAAA,WAAW,CAACC,IAAZ,GAAmBN,CAAnB;AACAK,MAAAA,WAAW,CAACE,GAAZ,GAAkBR,CAAlB;AACAK,MAAAA,cAAc,CAACnB,IAAf,CAAoBoB,WAApB;AACD,KALD;AAMAxB,IAAAA,CAAC,CAACE,OAAF,GAAYqB,cAAZ;AACD,GAxDD,EAXkD,CAqElD;;AACAlC,EAAAA,KAAK,CAACU,OAAN,CAAc,UAAU4B,CAAV,EAAa;AACzB,QAAIrC,UAAU,CAACqC,CAAD,CAAd,EAAmB;AACjBrC,MAAAA,UAAU,CAACqC,CAAD,CAAV,CAAc5B,OAAd,CAAsB,UAAUC,CAAV,EAAa;AACjCA,QAAAA,CAAC,CAACG,GAAF,GAAQwB,CAAR;AACD,OAFD;AAGD;AACF,GAND;AAQA,SAAOrC,UAAP;AACD","sourcesContent":["import {getLeadsTo} from 'dataTools.js';\n\nexport function setupData(data, installment, types) {\n  let sortedData = cloneDeep(data);\n  let displayed = [];\n  let unlocksList = [];\n\n  // First, arrange the technologies by cost\n  if (installment > 3) {\n    sortedData.technologies.sort((a, b) => b.cost - a.cost);\n  }\n\n  // Scoop up all the things each technology leads to and put it in the unlocks object\n  sortedData.technologies.forEach((d) => {\n    let uniqueUnlocks = [];\n    let unlocks;\n\n    d.cat = 'technologies';\n    displayed.push(d);\n\n    unlocks = getLeadsTo(d, sortedData.units);\n    unlocks = unlocks.concat(getLeadsTo(d, sortedData.buildings));\n    unlocks = unlocks.concat(getLeadsTo(d, sortedData.build));\n    if (sortedData.civics) {\n        unlocks = unlocks.concat(getLeadsTo(d, sortedData.civics));\n    }\n    if (sortedData.projects) {\n        unlocks = unlocks.concat(getLeadsTo(d, sortedData.projects));\n    }\n    if (sortedData.promotions) {\n        unlocks = unlocks.concat(getLeadsTo(d, sortedData.promotions));\n    }\n    if (sortedData.religions) {\n        unlocks = unlocks.concat(getLeadsTo(d, sortedData.religions));\n    }\n    if (sortedData.resources) {\n        unlocks = unlocks.concat(getLeadsTo(d, sortedData.resources));\n    }\n\n    if (d.special) {\n      d.special.forEach(function (s) {\n        s.cat = 'specials';\n        s.requires = [];\n        s.requires.push(d.id);\n        unlocks.push(s);\n      });\n    }\n\n    unlocks.forEach(function (u, j) {\n      let matchFound = 0;\n      unlocksList.forEach(function (l, k) {\n        if (u.id === l.id) {\n          matchFound = 1;\n        }\n      });\n      if (matchFound !== 1) {\n          uniqueUnlocks.push(u);\n      }\n    });\n    unlocksList = unlocksList.concat(uniqueUnlocks);\n\n    let unlocksHandler = [];\n    uniqueUnlocks.forEach(function (u, j) {\n      let unlocksItem = {};\n      unlocksItem.rank = j;\n      unlocksItem.ref = u;\n      unlocksHandler.push(unlocksItem);\n    });\n    d.unlocks = unlocksHandler;\n  });\n\n  // Label data categories\n  types.forEach(function (t) {\n    if (sortedData[t]) {\n      sortedData[t].forEach(function (d) {\n        d.cat = t;\n      });\n    }\n  });\n\n  return sortedData;\n}"]},"metadata":{},"sourceType":"module"}